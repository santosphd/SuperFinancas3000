unit FormasPagamento;

interface

uses
  Winapi.Windows, Winapi.Messages, System.SysUtils, System.Variants, System.Classes, Vcl.Graphics,
  Vcl.Controls, Vcl.Forms, Vcl.Dialogs, Vcl.Buttons, Vcl.StdCtrls, Data.DB,
  Vcl.Menus, Vcl.Grids, Vcl.DBGrids;

type
  TfrmFormaPagamento = class(TForm)
    edtDescricao: TEdit;
    edtBanco: TEdit;
    edtAgencia: TEdit;
    edtConta: TEdit;
    edtBandeira: TEdit;
    Label1: TLabel;
    Label2: TLabel;
    Label3: TLabel;
    Label4: TLabel;
    Label5: TLabel;
    btnNovo: TSpeedButton;
    btnExcluir: TSpeedButton;
    btnSalvar: TSpeedButton;
    Label6: TLabel;
    btnEditar: TSpeedButton;
    DBGrid1: TDBGrid;
    MainMenu1: TMainMenu;
    BuscarFormadePagamento1: TMenuItem;
    procedure btnSalvarClick(Sender: TObject);
    procedure BuscarFormadePagamento1Click(Sender: TObject);
    procedure FormShow(Sender: TObject);
    procedure btnNovoClick(Sender: TObject);
    procedure DBGrid1CellClick(Column: TColumn);
  private
    { Private declarations }
    procedure habilitarCampos;
    procedure desabilitarCampos;
    procedure associarCampos;
    procedure limparCampos;
    procedure listar;
  public
    { Public declarations }
  end;

var
  frmFormaPagamento: TfrmFormaPagamento;

implementation

{$R *.dfm}

uses ConsultaFormasPagamento, Dados;

procedure TfrmFormaPagamento.BuscarFormadePagamento1Click(Sender: TObject);
begin
frmConsultaFormasPagamento.ShowModal;
end;

procedure TfrmFormaPagamento.DBGrid1CellClick(Column: TColumn);
begin
  habilitarCampos;
  btnEditar.Enabled := True;
  btnExcluir.Enabled := True;
  btnSalvar.Enabled := False;

  dmDados.tbFormaPagamento.Edit;
  edtDescricao.Text := dmDados.queryFormaPagamento.FieldByName('descricao').Value;
  edtBanco.Text := dmDados.queryFormaPagamento.FieldByName('banco').Value;
  edtAgencia.Text := dmDados.queryFormaPagamento.FieldByName('agencia').Value;
  edtConta.Text := dmDados.queryFormaPagamento.FieldByName('conta').Value;
  edtBandeira.Text := dmDados.queryFormaPagamento.FieldByName('bandeira').Value;

end;

procedure TfrmFormaPagamento.desabilitarCampos;
begin
  edtDescricao.Enabled := False;
  edtBanco.Enabled := False;
  edtAgencia.Enabled := False;
  edtConta.Enabled := False;
  edtBandeira.Enabled := False;
  btnNovo.Enabled := True;
  btnEditar.Enabled := False;
  btnSalvar.Enabled := False;
  btnExcluir.Enabled := False;
end;

procedure TfrmFormaPagamento.FormShow(Sender: TObject);
begin
  edtDescricao.Enabled := False;
  edtBanco.Enabled := False;
  edtAgencia.Enabled := False;
  edtConta.Enabled := False;
  edtBandeira.Enabled := False;
  btnNovo.Enabled := True;
  btnEditar.Enabled := False;
  btnSalvar.Enabled := False;
  btnExcluir.Enabled := False;
end;

procedure TfrmFormaPagamento.habilitarCampos;
begin
  edtDescricao.Enabled := True;
  edtBanco.Enabled := True;
  edtAgencia.Enabled := True;
  edtConta.Enabled := True;
  edtBandeira.Enabled := True;
  btnNovo.Enabled := False;
  btnEditar.Enabled := True;
  btnSalvar.Enabled := True;
  btnExcluir.Enabled := False;
end;

procedure TfrmFormaPagamento.limparCampos;
begin
  edtDescricao.Text := '';
  edtBanco.Text := '';
  edtAgencia.Text := '';
  edtConta.Text := '';
  edtBandeira.Text := '';
end;

procedure TfrmFormaPagamento.listar;
begin
  dmDados.queryFormaPagamento.Close;
  dmDados.queryFormaPagamento.SQL.Clear;
  dmDados.queryFormaPagamento.SQL.Add('SELECT codigo, descricao, banco, agencia, conta, bandeira, data_cadastro FROM forma_pagamento');
  dmDados.queryFormaPagamento.Open;
end;

procedure TfrmFormaPagamento.associarCampos;
begin
  dmDados.tbFormaPagamento.FieldByName('descricao').Value := edtDescricao.Text;
  dmDados.tbFormaPagamento.FieldByName('banco').Value := edtBanco.Text;
  dmDados.tbFormaPagamento.FieldByName('agencia').Value := edtAgencia.Text;
  dmDados.tbFormaPagamento.FieldByName('conta').Value := edtConta.Text;
  dmDados.tbFormaPagamento.FieldByName('bandeira').Value := edtBandeira.Text;
end;

procedure TfrmFormaPagamento.btnNovoClick(Sender: TObject);
begin
  habilitarCampos();
  limparCampos();
  dmDados.tbFormaPagamento.Insert; // ENTRA NO MODO DE INSERÇÃO DE DADOS

end;

procedure TfrmFormaPagamento.btnSalvarClick(Sender: TObject);
begin
  if Trim(edtDescricao.Text) = '' then
    begin
		  MessageDlg('Preencha o Nome!', mtInformation, mbOKCancel, 0);
		  edtDescricao.SetFocus;
		  //exit;
    end;

  associarCampos();
  dmDados.tbFormaPagamento.Post;
  MessageDlg('Salvo com sucesso', mtInformation, mbOKCancel, 0);
  limparCampos();
  desabilitarCampos();
  btnSalvar.Enabled := False;
  listar();

end;

end.
